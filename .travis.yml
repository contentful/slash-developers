language: node_js
dist: trusty
sudo: required

node_js: 5.1
ruby: 2.2.3

before_install:
  - mv Spelling-and-style-sheet/.spelling ./.spelling
  - sudo apt-get install jq
  - make -C apiary install
  - npm i markdown-spellcheck -g

script:
  - make -C apiary test
  - mdspell -r -n -a --en-us '**/*.md' '!**/node_modules/**/*.md'

cache:
  directories:
    - apiary/node_modules
    - node_modules

deploy:
  provider: script
  script: make -C apiary publish
  skip_cleanup: true
  on:
    branch: master

matrix:
  allow_failures:
  - script: mdspell -r -n -a --en-us '**/*.md' '!**/node_modules/**/*.md'
